<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>선생님코드</title>
    <script>
        function checks() {
            //1. 값 불러오기(회원가입할 때 작성한 값)
            //1-1. input 태그의 위치값 변수에 저장
            var getId = document.getElementById("id"); 
            var getPassword = document.getElementById("password");
            var getPwCheck = document.getElementById("password_check");
            var getMail = document.getElementById("mail"); 
            var getName = document.getElementById("name");
            var getIdNum = document.getElementById("id_num");
            var getIdNBack = document.getElementById("id_num_back");
            var getYy = document.getElementById("year");
            var getMm = document.getElementById("month");
            var getDd = document.getElementById("day");
            var getHobby = document.getElementsByName("hobby"); //관심분야는 id 가 없고 name이 있으니 getElementsByName 으로
            var getIntro = document.getElementById("intro");

            //1-2. value값 가져오기 - get__.values; 해당 위치에 입력한 값을 가져옴
            var id = getId.value;
            // alert(id); //잘 되는지 테스팅 팝업으로 입력한 내용이 나오면 ok
            var pw = getPassword.value;
            var pwCheck = getPwCheck.value;
            var mail = getMail.value;
            var name = getName.value;
            var idnum = getIdNum.value;
            var idNBack = getIdNBack.value;
            var year = getYy.value;
            var month = getMm.value;
            var day = getDd.value;
            var hobby = getHobby.value;
            var intro = getIntro.value;
            //주민번호 합치기
            var idJumin = idnum + "-" + idNBack;

            //2. 데이터의 유효성 검사
            //2-1. 4 ~ 12자 영문 대소문자와 숫자로만 입력하는 정규식 표현
            var regExp = /^[a-zA-Z0-9]{4,12}$/;
            //2-2. 이름: 한글만 2글자 이상
            var regName = /^[가-힣]{2,}$/;
            //2-3. 이메일
            var regMail = /[a-zA-Z0-9]{2,}@[a-zA-Z]{2,}.[a-zA-Z0-9]{2,4}/;
            //2-4. 주민등록번호
            var regIdNum = /\d{2}([0]\d|[1][0-2])([0][1-9]|[1-2]\d|[3][0-1])[-]*[1-4]\d{6}/;
            //2-5. 생일 년도
            var regYear = /^[0-9]{4}$/

            //3. 입력받은 값(value값)과 데이터 유효성 검사 자료 비교하기
            // alert (regExp.test(id)); //정규식 유효성 검사에 맞으며 true 출력, 맞지 않으면 False 출력

            // !로 인해 참이면 거짓으로 거짓이면 참으로
            
            if (! regExp.test(id)){ //정규표현식이 틀리면 regExp.test(id)가 false로 나오고 !로 인해 true가 됨
                alert("아이디의 형식이 틀립니다. 다시 입력하세요.");
                getId.value = ""; //잘못 쳤으니까 지워주고("") 커서이동(focus())
                getId.focus();
                return false; //body의 form의 return checks()함수로 돌아감(밑의 elseif를 실행 X), 이거 안치면 action이 실행됨
            } else if (! regExp.test(pw)) {
                    alert("비밀번호의 형식이 틀립니다. 다시 입력하세요.");
                    getPassword.value = "";
                    getPassword.focus();
                    return false;
            } else if (pwCheck.slice(0,pwCheck.length) != pw.slice(0,pw.length)) {
                    alert("비밀번호가 다릅니다. 다시 입력하세요.");
                    getPwCheck.value = "";
                    getPwCheck.focus();
                    return false;
            } else if (id.slice(0,id.length) == pw.slice(0,pw.length)) { //아이디랑 비밀번호가 같으면 안돼
                    alert("아이디와 비밀번호가 같습니다. 다르게 입력해주세요.");
                    getPassword.value = "";
                    getPwCheck.value = "";
                    getPassword.focus();
                    return false;
            } else if (! regMail.test(mail)) {
                    alert("메일 주소의 형식이 틀립니다. 다시 입력하세요.");
                    getMail.value = "";
                    getMail.focus();
                    return false;
            }
            else if (! regName.test(name)) {
                    alert("이름의 형식이 틀립니다. 한글로만 입력하세요.");
                    getName.value = "";
                    getName.focus();
                    return false;
            }/* else if (! regIdNum.test(idJumin)) {
                    alert("주민등록번호의 형식이 틀립니다. 다시 입력하세요.");
                    getIdNum.value = "";
                    getIdNBack.value = "";
                    getIdNum.focus();
                    return false;
            }*/ else if (! check_Jumin()){
                    return false;
             }
            //관심분야를 한개라도 체크가 안되면 체크해달라고 요구
            //체크박스 체크여부 확인
             //alert(document.data.hobby[0].checked) //체크박스들 중 첫번째(0번째)가 체크되어 있다면
            else if((document.data.hobby[0].checked == false) && (document.data.hobby[1].checked == false) &&
             (document.data.hobby[2].checked == false) && (document.data.hobby[3].checked == false) && 
             (document.data.hobby[4].checked == false)) {
                    alert("적어도 한 개의 체크박스를 체크해주세요.");
                    return false;
             } else if (getIntro.value == ""){
                    alert("자기소개를 적어주세요.");
                    getIntro.focus();
                    return false;
             } 
            
            //alert(pwCheck.slice(0,3)); //0번 인덱스부터 2번인덱스까지 출력해줌
            //alert(pwCheck.length()); //pwCheck의 길이

            //관심분야를 한개라도 체크가 안되면 체크해달라고 요구
            //체크박스 체크여부 확인
            
        } 

        //올바른 주민번호 체크 함수
        function check_JuminOk() {
            var jumin = document.getElementById("id_num").value + document.getElementById("id_num_back").value;
                        // 주민번호앞자리의 위치            의 값  ->"9608062012341"
            //주민번호의 정규표현식
            var regJuminnum = /^\d{6}[1234]\d{6}$/
            if (regJuminnum.test(jumin)) {
                return true;
            } else {
                return false;
            }
        }

        function check_Jumin() {
            if(check_JuminOk() ) { //cjeck_JuminOk가 참이면
                // console.log("여기를 찍어보자"); //f12를 눌러 어디에서 에러가 나는지 확인 가능
                alert("올바른 주민번호입니다");
                var year = document.getElementById("year"); //생년월일에서 년도
                var num1 = document.getElementById("id_num"); //주민번호 앞부분 960806
                var num2 = num1.value; //num2 = 960806
                //console.log("여기를 찍어보자" + num2);
                var num3 = num2.slice(0,2); //96
                var num4 = num2.slice(2,4); //08
                var num5 = num2.slice(4,6); //06
                
                var inb = document.getElementById("id_num_back").value; //주민번호 뒷자리의 첫번째 숫자가 3 이상이면 2000년도 사람
                var gender = inb.slice(0,1); //현재는 문자열이기 때문에 숫자로 변환해야함
                gender = Number(gender);
                if (gender <= 2) {
                    year.value = "19" + num3;
                } else {
                    year.value = "20" + num3;
                }
                document.data.month.value = num4;
                document.data.day.value = num5;
                return true;

            } else {
                alert("주민번호가 틀렸습니다");
                return false;
            }
        }

    </script>
</head>
<body>

        <form action="server.jsp" name="data" method="post" onsubmit="return checks()">
    
            <!--밑에 submit 누르면 메일로 보내짐-->
    
        <table border="1" bordercolor="grey" align="center">
    
            <tbody>
    
            <tr>
                <td colspan="2" bgcolor="lightblue" align="center">회원 기본 정보</td>    
            </tr>
    
            <tr>    
                <td bgcolor="lightgrey" align="center">아이디</td>    
                <td><input size="15" type="text" id="id"> 4~12자의 영문 대소문자와 숫자로만 입력</td>   
            </tr>
    
            <tr>    
                <td bgcolor="lightgrey" align="center">비밀번호</td>    
                <!-- size 는 칸 수-->
                <td><input size="15" type="password" id="password"> 4~12자의 영문 대소문자와 숫자로만 입력</td>   
            </tr>
    
            <tr>    
                <td bgcolor="lightgrey" align="center">비밀번호 확인</td>    
                <td><input size="15" type="password" id="password_check"></td>    
            </tr>
    
            <tr>    
                <td bgcolor="lightgrey" align="center">메일 주소</td>
                <td><input type="text" id="mail"> 예) id@domain.com</td>    
            </tr>
    
            <tr>    
                <td bgcolor="lightgrey" align="center">이름</td>    
                <td><input type="text" id="name"></td>    
            </tr>
    
            <tr>   
                <td colspan="2" bgcolor="lightblue" align="center"> 개인 신상 정보</td>    
            </tr>
    
            <tr>    
                <td bgcolor="lightgrey" align="center">주민등록번호</td>    
                <td>    
                    <input size="7" type="text" id="id_num">    
                    - <input size="7" type="password" id="id_num_back">       
                    <input type="button" onclick="check_Jumin()" value="확인">
                </td>
    
            </tr>
    
            <tr>    
                <td bgcolor="lightgrey" align="center">생일</td>    
                <td>    
                    <input size="5" type="text" id="year">년    
                    <select id="month">
    
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
    
                    </select>
                    월
    
                    <select id="day">
    
                            <option value="1">1</option>
                            <option value="2">2</option>
                            <option value="3">3</option>
                            <option value="4">4</option>
                            <option value="5">5</option>
                            <option value="6">6</option>
                            <option value="7">7</option>
                            <option value="8">8</option>
                            <option value="9">9</option>
                            <option value="10">10</option>
                            <option value="11">11</option>
                            <option value="12">12</option>
                            <option value="13">13</option>
                            <option value="14">14</option>
                            <option value="15">15</option>
                            <option value="16">16</option>
                            <option value="17">17</option>
                            <option value="18">18</option>
                            <option value="19">19</option>
                            <option value="20">20</option>
                            <option value="21">21</option>
                            <option value="22">22</option>
                            <option value="23">23</option>
                            <option value="24">24</option>
                            <option value="25">25</option>
                            <option value="26">26</option>
                            <option value="27">27</option>
                            <option value="28">28</option>
                            <option value="29">29</option>
                            <option value="30">30</option>
                            <option value="31">31</option>
                    </select>
    
                    일
    
                </td>
            </tr>
    
            <tr>
                <td bgcolor="lightgrey" align="center">관심분야</td>
    
                <td>
                    <input type="checkbox" name="hobby" value="computer" >컴퓨터
                    <input type="checkbox" name="hobby" value="internet">인터넷
                    <input type="checkbox" name="hobby" value="travel">여행
                    <input type="checkbox" name="hobby" value="movie">영화감상
                    <input type="checkbox" name="hobby" value="music">음악감상
                </td>
    
            </tr>
    
            <tr>
    
                <td bgcolor="lightgrey" align="center">자기소개</td>
    
                <td><textarea cols="50" style="margin: 0px; height: 300px; width:480px" id="intro"></textarea>
    
                    <!--크기 조정 가능-->
    
                </td>
    
            </tr>
    
        </tbody>
    
        </table>
    
            <p align="center">
    
                <input type="submit" value="회원 가입">
    
                <!--누르면 메일이 보내짐-->
    
                <input type="reset" value="다시 입력">
    
                <!--누르면 초기화-->
    
            </p>
    
    </form>
</body>
</html>